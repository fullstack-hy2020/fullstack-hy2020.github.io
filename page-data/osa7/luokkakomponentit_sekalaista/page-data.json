{"componentChunkName":"component---src-templates-content-template-js","path":"/osa7/luokkakomponentit_sekalaista","result":{"data":{"markdownRemark":{"html":"<div class=\"content\">\n<h3>Luokkakomponentit</h3>\n<p>Olemme käyttäneet kurssilla ainoastaan JavaScript-funktioina määriteltyjä React-komponentteja. Tämä ei ollut mahdollista ennen Reactiin versiossa 16.8. tullutta <a href=\"https://reactjs.org/docs/hooks-intro.html\">hook</a>-toiminnallisuutta, tällöin esimerkiksi tilaa käyttävät komponentit oli pakko määritellä käyttäen JavaScriptin <a href=\"https://reactjs.org/docs/state-and-lifecycle.html#converting-a-function-to-a-class\">Class</a>-syntaksia.</p>\n<p>Class-, eli luokkakomponentit on syytä tuntea ainakin jossain määrin, sillä maailmassa on suuri määrä vanhaa React-koodia, mitä ei varmaankaan koskaan tulla kokonaisuudessaan uudelleenkirjoittamaan uudella syntaksilla.</p>\n<p>Tutustutaan nyt luokkakomponenttien tärkeimpiin ominaisuuksiin toteuttamalla jälleen kerran jo niin tuttu anekdoottisovellus. Talletetaan anekdootit <i>json-serveriä</i> hyödyntäen tiedostoon <i>db.json</i>. Tiedoston sisältö otetaan <a href=\"https://github.com/fullstack-hy2020/misc/blob/master/anecdotes.json\">täältä</a>.</p>\n<p>Luokkakomponentin ensimmäinen versio näyttää seuraavalta</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>anecdote <span class=\"token keyword\">of</span> the day<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App</code></pre></div>\n<p>Komponentilla on nyt <a href=\"https://reactjs.org/docs/react-component.html#constructor\">konstruktori</a> missä ei toistaiseksi tehdä mitään sekä metodi <a href=\"https://reactjs.org/docs/react-component.html#render\">render</a>. Kuten arvata saattaa, <em>render</em> määrittelee sen miten komponentti piirtyy ruudulle.</p>\n<p>Määritellään komponenttiin tila anekdoottien listalle sekä näkyvissä olevalle anekdootille. Toisin kuin <a href=\"https://reactjs.org/docs/hooks-state.html\">useState</a>-hookia käytettäessä, luokkakomponenteilla on ainoastaan yksi tila. Eli jos tila koostuu useista \"osista\", tulee osat tallettaa tilan kenttiin.  Tila alustetaan konstruktorissa:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token literal-property property\">anecdotes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token literal-property property\">current</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span>  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>anecdotes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>      <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>no anecdotes<span class=\"token operator\">...</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>anecdote <span class=\"token keyword\">of</span> the day<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n<span class=\"gatsby-highlight-code-line\">          <span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>anecdotes<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">}</span></span>        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>button<span class=\"token operator\">></span>next<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Komponentin tila on siis instanssimuuttujassa <em>this.state</em>. Tila on olio, jolla on kaksi kenttää. <i>this.state.anecdotes</i> on anekdoottien lista ja <i>this.state.current</i> on näytettävän anekdootin indeksi.</p>\n<p>Funktionaalisille komponenteille oikea paikka hakea palvelimella olevaa dataa ovat <a href=\"https://reactjs.org/docs/hooks-effect.html\">effect hookit</a>. Effect hookit suoritetaan aina komponentin renderöitymisen yhteydessä tai tarvittaessa harvemmin, esim. ainoastaan ensimmäisen renderöinnin yhteydessä.</p>\n<p>Luokkakomponenttien <a href=\"https://reactjs.org/docs/state-and-lifecycle.html#adding-lifecycle-methods-to-a-class\">elinkaarimetodit</a> tarjoavat vastaavan toiminnallisuuden. Oikea paikka käynnistää tietojen haku palvelimelta on  elinkaarimetodi <a href=\"https://reactjs.org/docs/react-component.html#componentdidmount\">componentDidMount</a>, joka suoritetaan kertaalleen heti komponentin ensimmäisen renderöitymisen jälkeen:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">anecdotes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">current</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function-variable function\">componentDidMount</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/anecdotes'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">anecdotes</span><span class=\"token operator\">:</span> response<span class=\"token punctuation\">.</span>data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>HTTP-pyynnön takaisinkutsufunktio päivittää komponentin tilaa metodilla <a href=\"https://reactjs.org/docs/react-component.html#setstate\">setState</a>. Metodi toimii siten, että se koskee tilassa ainoastaan niihin avaimiin, mitä parametrina olevassa oliossa on määritelty. Avain <i>current</i> jää siis entiseen arvoonsa.</p>\n<p>Metodin setState kutsuminen aiheuttaa aina luokkakomponentin uudelleenrenderöinnin, eli metodin <em>render</em> kutsun.</p>\n<p>Viimeistellään vielä komponentti siten, että näytettävä anekdootti on mahdollista vaihtaa. Seuraavassa koko komponentin koodi, lisäys korostettuna:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">anecdotes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">current</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function-variable function\">componentDidMount</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/anecdotes'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">anecdotes</span><span class=\"token operator\">:</span> response<span class=\"token punctuation\">.</span>data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function-variable function\">handleClick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> current <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span></span><span class=\"gatsby-highlight-code-line\">      Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>anecdotes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> current <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>anecdotes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>no anecdotes<span class=\"token operator\">...</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>anecdote <span class=\"token keyword\">of</span> the day<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>anecdotes<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handleClick<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>next<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span></span>      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Vertailun vuoksi sama sovellus funktionaalisena komponenttina:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>anecdotes<span class=\"token punctuation\">,</span> setAnecdotes<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>current<span class=\"token punctuation\">,</span> setCurrent<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n    axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/anecdotes'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setAnecdotes</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleClick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCurrent</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>anecdotes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>anecdotes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>no anecdotes<span class=\"token operator\">...</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>anecdote <span class=\"token keyword\">of</span> the day<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>anecdotes<span class=\"token punctuation\">[</span>current<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleClick<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>next<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Esimerkkimme tapauksessa erot eivät ole suuret. Suurin ero funktionaalisissa ja luokkakomponenteissa lienee se, että luokkakomponentin tila on aina yksittäinen olio, ja tilaa muutetaan metodin <em>setState</em> avulla kun taas funktionaalisessa komponentissa tila voi koostua useista muuttujista, joilla kaikilla on oma päivitysfunktio.</p>\n<p>Hieman edistyneemmissä käyttöskenaarioissa effect hookit tarjoavat huomattavasti paremman mekanismin sivuvaikutusten hallintaan verrattuna luokkakomponenttien elinkaarimetodeihin.</p>\n<p>Merkittävä etu funktionaalisten komponenttien käytössä on se, että paljon harmia tuottavaa JavaScriptin olioon itseensä viittaavaa <em>this</em>-viitettä ei tarvitse käsitellä ollenkaan.</p>\n<p>Oman ja suuren enemmistön mielestä luokkakomponenteilla ei ole oikeastaan mitään etuja hookeilla rikastettuihin funktionaalisiin komponentteihin verrattuna, poikkeuksen tähän muodostaa ns. <a href=\"https://reactjs.org/docs/error-boundaries.html\">error boundary</a> ‑mekanismi, joka ei ole toistaiseksi funktionaalisten komponenttien käytössä.</p>\n<p>Kun kirjoitat uutta koodia, <a href=\"https://reactjs.org/docs/hooks-faq.html#should-i-use-hooks-classes-or-a-mix-of-both\">ei siis ole mitään rationaalista syytä käyttää luokkakomponentteja</a> jos projektissa on käytössä Reactista vähintään versio 16.8. Toisaalta kaikkea vanhaa Reactia <a href=\"https://reactjs.org/docs/hooks-faq.html#do-i-need-to-rewrite-all-my-class-components\">ei ole toistaiseksi mitään syytä uudelleenkirjoittaa</a> funktionaalisina komponentteina.</p>\n<h3>React-sovelluksen koodin organisointi</h3>\n<p>Noudatimme useimmissa sovelluksissa periaatetta, missä komponentit sijoitettiin hakemistoon <i>components</i>, reducerit hakemistoon <i>reducers</i> ja palvelimen kanssa kommunikoiva koodi hakemistoon <i>services</i>. Tälläinen organisoimistapa riittää pienehköihin sovelluksiin, mutta komponenttien määrän kasvaessa tarvitaan muunlaisia ratkaisuja. Yhtä oikeaa tapaa ei ole, artikkeli <a href=\"https://medium.com/hackernoon/the-100-correct-way-to-structure-a-react-app-or-why-theres-no-such-thing-3ede534ef1ed\">The 100% correct way to structure a React app (or why there’s no such thing)</a>\ntarjoaa näkökulmia aiheeseen.</p>\n<h3>Frontti ja backend samassa repositoriossa</h3>\n<p>Olemme kurssilla tehneet frontendin ja backendin omiin repositorioihinsa. Kyseessä on varsin tyypillinen ratkaisu. Teimme tosin deploymentin <a href=\"/osa3/sovellus_internetiin#staattisten-tiedostojen-tarjoaminen-backendista\">kopioimalla</a> frontin bundlatun koodin backendin repositorion sisälle. Toinen, ehkä järkevämpi tilanne olisi ollut deployata frontin koodi erikseen.</p>\n<p>Joskus voi kuitenkin olla tilanteita, missä koko sovellus halutaan samaan repositorioon. Tällöin yleinen ratkaisu on sijoittaa <i>package.json</i> ja <i>webpack.config.js</i> hakemiston juureen ja frontin sekä backendin koodi omiin hakemistoihinsa, esim. <i>client</i> ja <i>server</i>.</p>\n<h3>Palvelimella tapahtuvat muutokset</h3>\n<p>Jos palvelimella olevassa tilassa tapahtuu muutoksia, esim. blogilistapalveluun lisätään uusia blogeja muiden käyttäjien toimesta, tällä kurssilla tekemämme React-frontendit eivät huomaa muutoksia ennen sivujen uudelleenlatausta. Vastaava tilanne tulee eteen, jos frontendistä käynnistetään jotain kauemmin kestävää laskentaa backendiin, miten laskennan tulokset saadaan heijastettua frontendiin?</p>\n<p>Eräs tapa on suorittaa frontendissa <a href=\"https://en.wikipedia.org/wiki/Polling_(computer_science)\">pollausta</a>, eli toistuvia kyselyitä backendin APIin esim. <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval\">setInterval</a>-komennon avulla.</p>\n<p>Edistyneempi tapa on käyttää <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API\">WebSocketeja</a>, joiden avulla on mahdollista muodostaa kaksisuuntainen kommunikaatiokanava selaimen ja palvelimen välille. Tällöin frontendin ei tarvitse pollata backendia, riittää määritellä takaisinkutsufunktiot tilanteisiin, joissa palvelin lähettää WebSocketin avulla tietoja tilan päivittämisestä.</p>\n<p>WebSocketit ovat selaimen tarjoama rajapinta, jolla ei kuitenkaan ole kaikille selaimille vielä täyttä tukea:</p>\n<picture><img src=\"/static/770e202a06099a96c2607acdcc69204f/5a190/31ea.png\" srcset=\"/static/770e202a06099a96c2607acdcc69204f/772e8/31ea.png 200w,\n/static/770e202a06099a96c2607acdcc69204f/e17e5/31ea.png 400w,\n/static/770e202a06099a96c2607acdcc69204f/5a190/31ea.png 800w,\n/static/770e202a06099a96c2607acdcc69204f/c1b63/31ea.png 1200w,\n/static/770e202a06099a96c2607acdcc69204f/29007/31ea.png 1600w,\n/static/770e202a06099a96c2607acdcc69204f/cb1ac/31ea.png 1936w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>WebSocket API:n suoran käyttämisen sijaan onkin suositeltavaa käyttää <a href=\"https://socket.io/\">Socket.io</a>-kirjastoa, joka tarjoaa erilaisia automaattisia <i>fallback</i>-mahdollisuuksia, jos käytettävässä selaimessa ei ole täyttä WebSocket-tukea.</p>\n<p><a href=\"/osa8\">Osan 8</a> aiheena GraphQL, joka tarjoaa valmiin toiminnallisuuden palvelimella tapahtuvien muutosten synkronoimiseksi muutoksista kiinnostuneihin frontendeihin.</p>\n<h3>Virtual DOM</h3>\n<p>Reactin yhteydessä mainitaan usein käsite Virtual DOM. Mistä oikein on kyse? Kuten <a href=\"/osa0/web_sovelluksen_toimintaperiaatteita#document-object-model-eli-dom\">osassa 0</a> mainittiin, selaimet tarjoavat <a href=\"https://developer.mozilla.org/fi/docs/DOM\">DOM API</a>:n, jota hyväksikäyttäen selaimessa toimiva JavaScript voi muokata sivun ulkoasun määritteleviä elementtejä.</p>\n<p>Reactia käyttäessä ohjelmoija ei koskaan (tai parempi sanoa yleensä) manipuloi DOM:ia suoraan. React-komponentin määrittelevä funktio palauttaa joukon <a href=\"https://reactjs.org/docs/glossary.html#elements\">React-elementtejä</a>. Vaikka osa elementeistä näyttää normaaleilta HTML-elementeiltä</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Hello<span class=\"token punctuation\">,</span> world<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span></code></pre></div>\n<p>eivät nekään ole HTML:ää vaan pohjimmiltaan JavaScriptia olevia React-elementtejä.</p>\n<p>Sovelluksen komponenttien ulkoasun määrittelevät React-elementit muodostavat <a href=\"https://reactjs.org/docs/faq-internals.html#what-is-the-virtual-dom\">Virtual DOM:in</a>, joka pidetään suorituksen aikana keskusmuistissa.</p>\n<p><a href=\"https://reactjs.org/docs/react-dom.html\">ReactDOM</a>-kirjaston avulla komponenttien määrittelevä virtuaalinen DOM renderöidään oikeaksi DOM:iksi eli DOM API:n avulla selaimen näytettäväksi:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Kun sovelluksen tila muuttuu, määrittyy komponenttien renderöinnin takia <i>uusi virtuaalinen DOM</i>. Reactilla on edellinen versio virtual DOM:ista muistissa ja sen sijaan että uusi virtuaalinen DOM renderöitäisiin suoraviivaisesti DOM API:n avulla, React laskee mikä on optimaalisin tapa tehdä DOM:iin muutoksia (eli poistaa, lisätä ja muokata DOM:issa olevia elementtejä) siten, että DOM saadaan vastaamaan uutta Virtual DOM:ia.</p>\n<h3>Reactin roolista sovelluksissa</h3>\n<p>Materiaalissa ei ole tuotu ehkä riittävän selkeästi esille sitä, että React on ensisijaisesti tarkoitettu näkymien luomisesta huolehtivaksi kirjastoksi. Jos ajatellaan perinteistä <a href=\"https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller\">Model View Controller</a> ‑jaottelua, on Reactin toimialaa juurikin <i>View</i>. React on siis sovellusalueeltaan suppeampi kuin esim. <a href=\"https://angular.io/\">Angular</a>, joka on kaiken tarjoava Frontendin MVC-sovelluskehys. Reactia ei kutsutakaan sovelluskehykseksi (framework) vaan <i>kirjastoksi</i> (library).</p>\n<p>Pienissä sovelluksissa React-komponenttien tilaan talletetaan sovelluksen käsittelemää dataa, eli komponenttien tilan voi näissä tapauksissa ajatella vastaavan MVC:n <i>modeleita</i>.</p>\n<p>React-sovellusten yhteydessä ei kuitenkaan yleensä puhuta MVC-arkkitehtuurista ja jos käytössä on Redux niin silloin sovellukset noudattavat <a href=\"https://facebookarchive.github.io/flux/docs/in-depth-overview//\">Flux</a>-arkkitehtuuria ja Reactin rooliksi jää entistä enemmän pelkkä näkymien muodostaminen. Varsinainen sovelluslogiikka hallitaan Reduxin tilan ja action creatorien avulla. Jos käytössä on osasta 6 tuttu <a href=\"/osa6/redux_sovelluksen_kommunikointi_palvelimen_kanssa#asynkroniset-actionit-ja-redux-thunk\">redux thunk</a>, on sovelluslogiikka mahdollista eristää lähes täysin React-koodista.</p>\n<p>Koska sekä React että <a href=\"https://facebookarchive.github.io/flux/docs/in-depth-overview//\">Flux</a> ovat Facebookilla syntyneinä, voi ajatella, että Reactin pitäminen ainoastaan käyttöliittymästä huolehtivana kirjastona on sen oikeaoppista käyttöä. Flux-arkkitehtuurin noudattaminen tuo sovelluksiin tietyn overheadin ja jos on kyse pienestä sovelluksesta tai prototyypistä, saattaa Reactin \"väärinkäyttäminen\" olla järkevää, sillä myöskään <a href=\"https://en.wikipedia.org/wiki/Overengineering\">overengineering</a> ei yleensä johda optimaaliseen tulokseen.</p>\n<p>Osan 6 <a href=\"/osa6/react_query_use_reducer_ja_context\">viimeinen luku</a> käsittelee Reactin tilanhallinnan uudempia virtauksia. Reactin suoraan tarjoamat hook-funktiot <i>useReducer</i> ja <i>useContext</i> tarjoavat eräänlaisen kevytversion Reduxille. <i>React Query</i> taas on kirjasto joka ratkaisee monia palvelimella olevan tilan käsittelyyn liittyviä pulmia, eliminoiden tarvetta sille, että React-sovelluksen tarvitsee tallettaa suoraan frontendin tilaan palvelimelta haettua dataa.</p>\n<h3>React/node-sovellusten tietoturva</h3>\n<p>Emme ole vielä maininneet kurssilla kuin muutaman sanan tietoturvaan liittyen. Kovin paljon ei nytkään ole aikaa, ja onneksi Helsingin Yliopistolla on MOOC-kurssi <a href=\"https://cybersecuritybase.mooc.fi/module-2.1\">Securing Software</a> tähän tärkeään aihepiiriin.</p>\n<p>Katsotaan kuitenkin muutamaa kurssispesifistä seikkaa.</p>\n<p>The Open Web Application Security Project eli <a href=\"https://www.owasp.org\">OWASP</a> julkaisee vuosittain listan Websovellusten yleisimmistä turvallisuusuhista. Tuorein lista on <a href=\"https://owasp.org/Top10/\">täällä</a>. Samat uhat ovat listalla vuodesta toiseen.</p>\n<p>Listaykkösenä on <i>injection</i>, joka tarkoittaa sitä, että sovellukseen esim. lomakkeen avulla lähetettävä teksti tulkitaankin aivan eri tavalla kun sovelluskehittäjä on tarkoittanut. Kuuluisin injektioiden muoto lienevät <a href=\"https://stackoverflow.com/questions/332365/how-does-the-sql-injection-from-the-bobby-tables-xkcd-comic-work\">SQL-injektiot</a>.</p>\n<p>Esim. jos ei-turvallisessa koodissa tehtäisiin seuraavasti muotoiltu SQL-kysely:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> query <span class=\"token operator\">=</span> <span class=\"token string\">\"SELECT * FROM Users WHERE name = '\"</span> <span class=\"token operator\">+</span> userName <span class=\"token operator\">+</span> <span class=\"token string\">\"';\"</span></code></pre></div>\n<p>Oletetaan että hieman ilkeämielinen käyttäjä <i>Arto Hellas</i> nyt määrittelisi nimekseen</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Arto Hell-as'; DROP TABLE Users; --</code></pre></div>\n<p>eli nimi sisältäisi hipsun <code>'</code>, joka on SQL:ssä merkkijonon aloitus/lopetusmerkki. Tämän seurauksena tulisi suoritetuksi kaksi SQL-operaatiota, joista jälkimmäinen tuhoaisi tietokantataulun <i>Users</i></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> Users <span class=\"token keyword\">WHERE</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Arto Hell-as'</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> Users<span class=\"token punctuation\">;</span> <span class=\"token comment\">--'</span></code></pre></div>\n<p>SQL-injektiot estetään <a href=\"https://security.stackexchange.com/questions/230211/why-are-stored-procedures-and-prepared-statements-the-preferred-modern-methods-f\">parametrisoiduilla kyselyillä</a>. Niissä käyttäjän syötettä ei lisätä lainkaan SQL-kyselyn sekaan, vaan tietokanta itse lisää syötearvot turvallisesti kyselyssä olevien paikkamerkkien (yleensä <code>?</code>) paikalle.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SELECT * FROM Users WHERE name = ?\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>userName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Myös NoSQL-kantoihin tehtävät injektiohyökkäykset ovat mahdollisia. Mongoose kuitenkin estää ne <a href=\"https://zanon.io/posts/nosql-injection-in-mongodb\">sanitoimalla</a> kyselyt. Lisää aiheesta esim. <a href=\"https://web.archive.org/web/20220901024441/https://blog.websecurify.com/2014/08/hacking-nodejs-and-mongodb.html\">täällä</a>.</p>\n<p><i>Cross-site scripting eli XSS</i> on hyökkäys, missä sovellukseen on mahdollista injektoida suoritettavaksi vihollismielistä JavaScript-koodia. Jos kokeilemme injektoida esim. muistiinpanosovellukseen seuraavan</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Evil XSS attack'</span><span class=\"token punctuation\">)</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>koodia ei suoriteta, vaan koodi renderöityy sivulle 'tekstinä':</p>\n<picture><img src=\"/static/7fee25a58d613e21d229e3b3db6c61d0/5a190/32e.png\" srcset=\"/static/7fee25a58d613e21d229e3b3db6c61d0/772e8/32e.png 200w,\n/static/7fee25a58d613e21d229e3b3db6c61d0/e17e5/32e.png 400w,\n/static/7fee25a58d613e21d229e3b3db6c61d0/5a190/32e.png 800w,\n/static/7fee25a58d613e21d229e3b3db6c61d0/c1b63/32e.png 1200w,\n/static/7fee25a58d613e21d229e3b3db6c61d0/0d98f/32e.png 1276w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>sillä React <a href=\"https://reactjs.org/docs/introducing-jsx.html#jsx-prevents-injection-attacks\">huolehtii muuttujissa olevan datan sanitoinnista</a>. Reactin jotkut versiot <a href=\"https://medium.com/dailyjs/exploiting-script-injection-flaws-in-reactjs-883fb1fe36c1\">ovat mahdollistaneet</a> XSS-hyökkäyksiä, aukot on toki korjattu, mutta mikään ei takaa etteikö niitä voisi vielä löytyä.</p>\n<p>Käytettyjen kirjastojen suhteen tuleekin olla tarkkana, jos niihin tulee tietoturvapäivityksiä, on kirjastot syytä päivittää omissa sovelluksissa. Expressin tietoturvapäivitykset löytyvät <a href=\"https://expressjs.com/en/advanced/security-updates.html\">kirjaston dokumentaatiosta</a> ja Nodeen liittyvät <a href=\"https://nodejs.org/en/blog/vulnerability/\">blogista</a>.</p>\n<p>Riippuvuuksien ajantasaisuuden voi testata komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> outdated <span class=\"token parameter variable\">--depth</span> <span class=\"token number\">0</span></code></pre></div>\n<p>Vuoden vanha <a href=\"/osa9\">osassa 9</a> käytetty projekti sisältää jo aika paljon vanhentuneita riippuvuuksia:</p>\n<picture><img src=\"/static/b199b453cdb888941aed98daf5c32b0a/5a190/33x.png\" srcset=\"/static/b199b453cdb888941aed98daf5c32b0a/772e8/33x.png 200w,\n/static/b199b453cdb888941aed98daf5c32b0a/e17e5/33x.png 400w,\n/static/b199b453cdb888941aed98daf5c32b0a/5a190/33x.png 800w,\n/static/b199b453cdb888941aed98daf5c32b0a/c1b63/33x.png 1200w,\n/static/b199b453cdb888941aed98daf5c32b0a/29007/33x.png 1600w,\n/static/b199b453cdb888941aed98daf5c32b0a/3a1b1/33x.png 1686w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Riippuvuudet saa ajantasaistettua päivittämällä tiedostoa <i>package.json</i>. Sitä helpottaa <a href=\"https://www.npmjs.com/package/npm-check-updates\">npm-check-updates</a>-niminen työkalu, joka asennetaan globaalisti komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-g</span> npm-check-updates</code></pre></div>\n<p>Tämän työkalun avulla tarkistetaan riippuvuuksien ajantasaisuus seuraavasti:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ npm-check-updates\nChecking <span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">\\</span>ultimate-hooks<span class=\"token punctuation\">\\</span>package.json\n<span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token punctuation\">]</span> <span class=\"token number\">9</span>/9 <span class=\"token number\">100</span>%\n\n @testing-library/react       ^13.0.0  →  ^13.1.1\n @testing-library/user-event  ^14.0.4  →  ^14.1.1\n react-scripts                  <span class=\"token number\">5.0</span>.0  →    <span class=\"token number\">5.0</span>.1\n\nRun ncu <span class=\"token parameter variable\">-u</span> to upgrade package.json</code></pre></div>\n<p>Tiedosto <i>package.json</i> päivitetään suorittamalla komento <em>ncu -u</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ ncu <span class=\"token parameter variable\">-u</span>\nUpgrading <span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">\\</span>ultimate-hooks<span class=\"token punctuation\">\\</span>package.json\n<span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token punctuation\">]</span> <span class=\"token number\">9</span>/9 <span class=\"token number\">100</span>%\n\n @testing-library/react       ^13.0.0  →  ^13.1.1\n @testing-library/user-event  ^14.0.4  →  ^14.1.1\n react-scripts                  <span class=\"token number\">5.0</span>.0  →    <span class=\"token number\">5.0</span>.1\n\nRun <span class=\"token function\">npm</span> <span class=\"token function\">install</span> to <span class=\"token function\">install</span> new versions.</code></pre></div>\n<p>Seuraavaksi ajantasaistetaan riippuvuudet suorittamalla komento <em>npm install</em>. Riippuvuuksien vanhat versiot eivät tietenkään välttämättä ole tietoturvariski.</p>\n<p>Riippuvuuksien turvallisuus voidaan tarkistaa npm:n <a href=\"https://docs.npmjs.com/cli/audit\">audit</a>-komennolla, joka vertaa käytettyjen riippuvuuksien versioita keskitetyssä virhetietokannassa listattuihin tietoturvauhan sisältäviin riippuvuuksien versioihin.</p>\n<p>Komennon <em>npm audit</em> suorittaminen samalle projektille antaa pitkän listan valituksia ja korjausehdotuksia. Seuraavassa osa raportista:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">$ npm audit\n\n<span class=\"token operator\">...</span> many lines removed <span class=\"token operator\">...</span>\n\nurl<span class=\"token operator\">-</span>parse  <span class=\"token operator\">&lt;</span><span class=\"token number\">1.5</span><span class=\"token number\">.2</span>\n<span class=\"token literal-property property\">Severity</span><span class=\"token operator\">:</span> moderate\nOpen redirect <span class=\"token keyword\">in</span> url<span class=\"token operator\">-</span>parse <span class=\"token operator\">-</span> https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>advisories<span class=\"token operator\">/</span><span class=\"token constant\">GHSA</span><span class=\"token operator\">-</span>hh27<span class=\"token operator\">-</span>ffr2<span class=\"token operator\">-</span>f2jc\nfix available via <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">npm audit fix</span><span class=\"token template-punctuation string\">`</span></span>\nnode_modules<span class=\"token operator\">/</span>url<span class=\"token operator\">-</span>parse\n\nws  <span class=\"token number\">6.0</span><span class=\"token number\">.0</span> <span class=\"token operator\">-</span> <span class=\"token number\">6.2</span><span class=\"token number\">.1</span> <span class=\"token operator\">||</span> <span class=\"token number\">7.0</span><span class=\"token number\">.0</span> <span class=\"token operator\">-</span> <span class=\"token number\">7.4</span><span class=\"token number\">.5</span>\n<span class=\"token literal-property property\">Severity</span><span class=\"token operator\">:</span> moderate\nReDoS <span class=\"token keyword\">in</span> Sec<span class=\"token operator\">-</span>Websocket<span class=\"token operator\">-</span>Protocol header <span class=\"token operator\">-</span> https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>advisories<span class=\"token operator\">/</span><span class=\"token constant\">GHSA</span><span class=\"token operator\">-</span>6fc8<span class=\"token operator\">-</span>4gx4<span class=\"token operator\">-</span>v693\nReDoS <span class=\"token keyword\">in</span> Sec<span class=\"token operator\">-</span>Websocket<span class=\"token operator\">-</span>Protocol header <span class=\"token operator\">-</span> https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>advisories<span class=\"token operator\">/</span><span class=\"token constant\">GHSA</span><span class=\"token operator\">-</span>6fc8<span class=\"token operator\">-</span>4gx4<span class=\"token operator\">-</span>v693\nfix available via <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">npm audit fix</span><span class=\"token template-punctuation string\">`</span></span>\nnode_modules<span class=\"token operator\">/</span>webpack<span class=\"token operator\">-</span>dev<span class=\"token operator\">-</span>server<span class=\"token operator\">/</span>node_modules<span class=\"token operator\">/</span>ws\nnode_modules<span class=\"token operator\">/</span>ws\n\n<span class=\"token number\">120</span> <span class=\"token function\">vulnerabilities</span> <span class=\"token punctuation\">(</span><span class=\"token number\">102</span> moderate<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> high<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> critical<span class=\"token punctuation\">)</span>\n\nTo address issues that <span class=\"token keyword\">do</span> not require attention<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">run</span><span class=\"token operator\">:</span>\n  npm audit fix\n\nTo address all <span class=\"token function\">issues</span> <span class=\"token punctuation\">(</span>including breaking changes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">run</span><span class=\"token operator\">:</span>\n  npm audit fix <span class=\"token operator\">--</span>force</code></pre></div>\n<p>Reilun vuoden ikäinen koodi on siis täynnä pieniä tietoturvauhkia, kriittisiä uhkia on onneksi ainoastaan 2. Suoritetaan raportin suosittelema operaatio <em>npm audit fix</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">$ npm audit fix\n\n<span class=\"token number\">104</span> <span class=\"token function\">vulnerabilities</span> <span class=\"token punctuation\">(</span><span class=\"token number\">93</span> moderate<span class=\"token punctuation\">,</span> <span class=\"token number\">9</span> high<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> critical<span class=\"token punctuation\">)</span>\n\nTo address issues that <span class=\"token keyword\">do</span> not require attention<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">run</span><span class=\"token operator\">:</span>\n  npm audit fix\n\nTo address all <span class=\"token function\">issues</span> <span class=\"token punctuation\">(</span>including breaking changes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">run</span><span class=\"token operator\">:</span>\n  npm audit fix <span class=\"token operator\">--</span>force</code></pre></div>\n<p>Haavoittuvuuksia jää vielä 104, sillä <em>audit fix</em> ei tee oletusarvoisesti versiopäivitystä kirjastolle, jonka <i>major</i>-versionumero on kasvanut. Tälläisen riippuvuuden päivitys saattaa aiheuttaa sovelluksen hajoamisen. </p>\n<p>Kriittisten virheiden lähde on kirjasto <a href=\"https://github.com/immerjs/immer\">immer</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">immer  <span class=\"token operator\">&lt;</span><span class=\"token number\">9.0</span><span class=\"token number\">.6</span>\n<span class=\"token literal-property property\">Severity</span><span class=\"token operator\">:</span> critical\nPrototype Pollution <span class=\"token keyword\">in</span> immer <span class=\"token operator\">-</span> https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>advisories<span class=\"token operator\">/</span><span class=\"token constant\">GHSA</span><span class=\"token operator\">-</span>33f9<span class=\"token operator\">-</span>j839<span class=\"token operator\">-</span>rf8h\nfix available via <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">npm audit fix --force</span><span class=\"token template-punctuation string\">`</span></span>\nWill install react<span class=\"token operator\">-</span>scripts@<span class=\"token number\">5.0</span><span class=\"token number\">.0</span><span class=\"token punctuation\">,</span> which is a breaking change</code></pre></div>\n<p>Komento <em>npm audit fix --force</em> päivittäisi käytetyn kirjastoversion, mutta emme nyt uskalla tehdä päivistystä sillä se aiheuttaisi <em>react-scripts</em>-kirjaston uuden version asennuksen ja se taas todennäköisesti hajottaisi sovelluskehitysympäristön. Jätämme siis tällä kertaa mahdollisten haavoittuvuuksien korjaamisen myöhempään kertaan.</p>\n<p>Eräs OWASP:in listan mainitsemista uhista on <i>Broken Authentication</i> ja siihen liittyvä <i>Broken Access Control</i>. Käyttämämme token-perustainen autentikointi on kohtuullisen robusti, jos sovellusta käytetään tietoliikenteen salaavalla HTTPS-protokollalla. Access Controlin eli pääsynhallinnan toteuttamisessa on aina syytä muistaa tehdä esim. käyttäjän identiteetin tarkastus selaimen lisäksi myös palvelimella. Huonoa tietoturvaa olisi estää jotkut toimenpiteet ainoastaan piilottamalla niiden suoritusmahdollisuus selaimessa olevasta koodista.</p>\n<p>Mozillan MDN:n erittäin hyvä <a href=\"https://developer.mozilla.org/en-US/docs/Learn/Server-side/First_steps/Website_security\">Website security ‑guide</a> nostaakin esiin tämän tärkeän seikan:</p>\n<picture><img src=\"/static/a7b95baf708b2945f316155b024c062d/5a190/34.png\" srcset=\"/static/a7b95baf708b2945f316155b024c062d/772e8/34.png 200w,\n/static/a7b95baf708b2945f316155b024c062d/e17e5/34.png 400w,\n/static/a7b95baf708b2945f316155b024c062d/5a190/34.png 800w,\n/static/a7b95baf708b2945f316155b024c062d/c1b63/34.png 1200w,\n/static/a7b95baf708b2945f316155b024c062d/52576/34.png 1412w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Expressin dokumentaatio sisältää tietoturvaa käsittelevän osan <a href=\"https://expressjs.com/en/advanced/best-practice-security.html\">Production Best Practices: Security</a> joka kannattaa lukea läpi. Erittäin suositeltavaa on ottaa backendissa käyttöön <a href=\"https://helmetjs.github.io/\">Helmet</a>-kirjasto, joka sisältää joukon Express-sovelluksista tunnettuja turvallisuusriskejä eliminoivia middlewareja.</p>\n<p>Myös ESlintin <a href=\"https://github.com/nodesecurity/eslint-plugin-security\">security-pluginin</a> käyttöönotto kannattaa.</p>\n<h3>Tämän päivän trendejä</h3>\n<p>Katsotaan vielä lopuksi muutamaa huomisen tai oikeastaan jo tämän päivän tekniikkaa, ja suuntia joihin Web-sovelluskehitys on kulkemassa.</p>\n<h4>JavaScriptin tyypitetyt versiot</h4>\n<p>JavaScriptin muuttujien <a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Dynamic_typing\">dynaaminen tyypitys</a> aiheuttaa välillä ikäviä bugeja. Osassa 5 käsittelimme lyhyesti <a href=\"/osa5/props_children_ja_proptypet#prop-types\">PropTypejä</a>, eli mekanismia, jonka avulla React-komponenteille välitettäville propseille on mahdollista tehdä tyyppitarkastuksia.</p>\n<p>Viime aikoina on ollut havaittavissa nousevaa kiinnostusta <a href=\"https://en.wikipedia.org/wiki/Type_system#Static_type_checking\">staattiseen tyypitykseen</a>. Tämän hetken suosituin JavaScriptin tyypitetty versio on Microsoftin kehittämä <a href=\"https://www.typescriptlang.org/\">TypeScript</a>, joka on aiheena kurssin <a href=\"/osa9\">osassa 9</a>.</p>\n<h4>Server side rendering, isomorfiset sovellukset ja universaali koodi</h4>\n<p>Selain ei ole ainoa paikka missä Reactilla määriteltyjä komponentteja voidaan renderöidä. Renderöinti on mahdollista tehdä myös <a href=\"https://reactjs.org/docs/react-dom-server.html\">palvelimella</a>. Tätä hyödynnetäänkin nykyään enenevissä määrin siten, että kun sovellukseen tullaan ensimmäistä kertaa, lähettää palvelin selaimeen jo valmiiksi renderöimänsä Reactilla muodostetun sivun. Tämän jälkeen sovelluksen toiminta jatkuu normaaliin tapaan, eli selain suorittaa Reactia, joka manipuloi selaimen näyttämää DOM:ia. Palvelimella tapahtuvasta renderöinnistä käytetään englanninkielistä nimitystä <i>server side rendering</i>.</p>\n<p>Eräs motivaatio server side renderingille on Search Engine Optimization eli SEO. Hakukoneet ovat ainakin perinteisesti olleet huonoja tunnistamaan selaimessa Javascriptillä renderöityä sisältöä, ajat saattavat tosin olla muuttumassa, ks. esim. <a href=\"https://www.javascriptstuff.com/react-seo/\">tämä</a> ja <a href=\"https://medium.freecodecamp.org/seo-vs-react-is-it-neccessary-to-render-react-pages-in-the-backend-74ce5015c0c9\">tämä</a>.</p>\n<p>Server side rendering ei tietenkään ole mikään React- tai edes JavaScript-spesifi asia, saman ohjelmointikielen käyttö kaikkialla koodissa tekee konseptista teoriassa helpommin toteutettavan, sillä samaa koodia voidaan suorittaa sekä backendissä että frontendissä.</p>\n<p>Palvelimella tapahtuvaan renderöintiin liittyen on alettu puhua <i>isomorfisista sovelluksista</i> ja <i>universaalista koodista</i>, termien määritelmistä on kiistelty. Joidenkin <a href=\"https://medium.com/@ghengeveld/isomorphism-vs-universal-javascript-4b47fb481beb\">määritelmien</a> mukaan isomorfinen web-sovellus on sellainen, joka suorittaa renderöintiä sekä selaimessa että backendissa. Universaalinen koodi taas on koodia, joka voidaan suorittaa useimmissa ympäristöissä eli sekä selaimessa että backendissä.</p>\n<p>React ja Node tarjoavatkin varteenotettavan vaihtoehdon isomorfisten sovellusten toteuttamiseen universaalina koodina.</p>\n<p>Universaalin koodin kirjoittaminen suoraan Reactin avulla on vielä toistaiseksi melko vaivalloista. Viime aikoina paljon huomiota saanut Reactin päälle toteutettu <a href=\"https://github.com/vercel/next.js\">Next.js</a>-kirjasto on hyvä vaihtoehto universaalien sovellusten tekemiseen.</p>\n<h4>Progressive web apps</h4>\n<p>Viime aikona on myös ruvettu käyttämään Googlen lanseeraamaa termiä <a href=\"https://developers.google.com/web/progressive-web-apps/\">progressive web app</a> (PWA). Googlen sivuilla oleva määritelmä kuulostaa markkinapuheelta ja sen perusteella on hankala saada selkeää käsitystä mistä on kyse. <a href=\"https://developers.google.com/web/progressive-web-apps/checklist\">Checklista</a> tuo mukaan konkretiaa.</p>\n<p>Tiivistäen kyse on web-sovelluksista, jotka toimivat mahdollisimman hyvin kaikilla alustoilla ottaen jokaisesta alustasta irti sen parhaat puolet. Mobiililaitteiden pienempi näyttö ei saa heikentää sovellusten käytettävyyttä. PWA-sovellusten tulee myös toimia offline-tilassa tai hitaalla verkkoyhteydellä moitteettomasti. Mobiililaitteilla ne tulee pystyä asentamaan normaalien sovellusten tavoin. Kaiken PWA-sovellusten käyttämän verkkoliikenteen tulee olla salattua.</p>\n<h4>Mikropalveluarkkitehtuuri</h4>\n<p>Tällä kurssilla olemme tehneet palvelinpuolelle ainoastaan matalan pintaraapaisun. Sovelluksissamme on ollut korkeintaan muutaman API-endpointin tarjoava <i>monoliittinen</i> eli yhdellä palvelimella pyörivä kokonaisuuden muodostava backend.</p>\n<p>Sovelluksen kasvaessa suuremmaksi monoliittisen backendin malli alkaa muuttua ongelmalliseksi niin suorituskyvyn kuin jatkokehitettävyydenkin kannalta.</p>\n<p><a href=\"https://martinfowler.com/articles/microservices.html\">Mikropalveluarkkitehtuurilla</a> (microservice) tarkoitetaan tapaa koostaa sovelluksen backend useista erillisistä autonomisista palveluista, jotka kommunikoivat keskenään verkon yli. Yksittäisen mikropalvelun on tarkoituksena hoitaa tietty looginen toiminnallinen kokonaisuus. Puhdasoppisessa mikropalveluarkkitehtuurissa palvelut eivät käytä jaettua tietokantaa.</p>\n<p>Esim. blogilistasovelluksen voisi koostaa kahdesta palvelusta, toinen huolehtisi käyttäjistä ja toinen blogeista. Käyttäjäpalvelun vastuulla olisi käyttäjätunnusten luominen ja käyttäjien autentikointi, blogipalvelu taas huolehtisi blogeihin liittyvistä toimista.</p>\n<p>Seuraava kuva havainnollistaa mikropalveluarkkitehtuuriin perustuvan sovelluksen rakennetta perinteiseen monoliittiseen rakenteeseen verrattuna:</p>\n<picture><img src=\"/static/beecf1d05714ef6a4ac0721fce62d394/5a190/36.png\" srcset=\"/static/beecf1d05714ef6a4ac0721fce62d394/772e8/36.png 200w,\n/static/beecf1d05714ef6a4ac0721fce62d394/e17e5/36.png 400w,\n/static/beecf1d05714ef6a4ac0721fce62d394/5a190/36.png 800w,\n/static/beecf1d05714ef6a4ac0721fce62d394/c1b63/36.png 1200w,\n/static/beecf1d05714ef6a4ac0721fce62d394/ce0a7/36.png 1590w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Frontendin (kuvassa neliöitynä) rooli ei välttämättä poikkea malleissa kovinkaan paljoa, mikropalveluiden ja frontendin välissä on usein <a href=\"http://microservices.io/patterns/apigateway\">API gateway</a> joka tarjoaa frontendille perinteisen kaltaisen, \"yhdessä palvelimessa\" olevan näkymän backendiin, esim. <a href=\"https://medium.com/netflix-techblog/optimizing-the-netflix-api-5c9ac715cf19\">Netflix</a> käyttää tätä ratkaisua.</p>\n<p>Mikropalveluarkkitehtuurit ovat syntyneet ja kehittyneet suurten internetskaalan sovellusten tarpeisiin. Trendin aloitti Amazon jo kauan ennen termin microservice lanseeraamista. Tärkeä lähtölaukaus oli CEO Jeff Bezosin vuonna 2002 kaikille työntekijöille lähettämä email:</p>\n<blockquote>\n<p>All teams will henceforth expose their data and functionality through service interfaces.</p>\n<p>Teams must communicate with each other through these interfaces.</p>\n<p>There will be no other form of inter-process communication allowed: no direct linking, no direct reads of another team’s data store, no shared-memory model, no back-doors whatsoever. The only communication allowed is via service interface calls over the network.</p>\n<p>It doesn’t matter what technology you use.</p>\n<p>All service interfaces, without exception, must be designed from the ground up to be externalize-able. That is to say, the team must plan and design to be able to expose the interface to developers in the outside world.</p>\n<p>No exceptions.</p>\n<p>Anyone who doesn’t do this will be fired. Thank you; have a nice day!</p>\n</blockquote>\n<p>Nykyään eräs vahvimmista suunnannäyttäjistä mikropalveluiden suhteen on <a href=\"https://www.infoq.com/presentations/netflix-chaos-microservices\">Netflix</a>.</p>\n<p>Mikropalveluista on pikkuhiljaa tullut hype, tämän ajan <a href=\"https://en.wikipedia.org/wiki/No_Silver_Bullet\">silver bullet</a>, jota yritetään tarjota ratkaisuiksi lähes kaikkiin ongelmiin. Mikropalveluarkkitehtuurin soveltamiseen liittyy kuitenkin suuri määrä haasteita ja voi olla järkevämpi lähteä liikeelle <a href=\"https://martinfowler.com/bliki/MonolithFirst.html\">monolith first</a>, eli tehdä aluksi perinteinen kaiken sisältävä backend. Tai sitten <a href=\"https://martinfowler.com/articles/dont-start-monolith.html\">ei</a>. Mielipiteitä on monenlaisia. Molemmat linkit johtavat Martin Fowlerin sivuille, eli viisaimmatkaan eivät ole ihan varmoja kumpi näistä oikeista tavoista on oikeampi.</p>\n<p>Emme voi valitettavasti syventyä tällä kurssilla tähän tärkeään aihepiiriin tämän tarkemmin. Jo pintapuolinenkin käsittely vaatisi ainakin 5 viikkoa lisää aikaa.</p>\n<p>Katso <a href=\"https://www.youtube.com/watch?v=BZexOyQZMMc&#x26;list=PLumQiZ25uijis31zaRL7rhzLalSwLqUtm%27\">täältä</a> Sympa Oy:n Panu Vartiaisen pitämä mikropalveluita käsittelevä vierailuluento.</p>\n<h4>Serverless</h4>\n<p>Loppuvuodesta 2014 tapahtuneen Amazonin <a href=\"https://aws.amazon.com/lambda/\">lambda</a>-palvelun julkaisun jälkeen alkoi web-sovellusten kehittämiseen nousta jälleen uusi trendi, <a href=\"https://serverless.com/\">serverless</a>.</p>\n<p>Kyse on siitä, että lambda ja nyttemmin Googlen <a href=\"https://cloud.google.com/functions/\">Cloud functions</a> ja <a href=\"https://azure.microsoft.com/en-us/services/functions/\">Azuren vastaava toiminnallisuus</a> mahdollistavat <i>yksittäisten funktioiden suorittamisen</i> pilvessä, kun ennen tätä pienin pilvessä suoritettava yksikkö oli käytännössä yksittäinen <i>prosessi</i>, eli esim. Node-backendiä suorittava ajoympäristö.</p>\n<p>Esim. Amazonin <a href=\"https://aws.amazon.com/api-gateway/\">API-gateway</a>:n avulla on mahdollista tehdä \"palvelimettomia\" sovelluksia, missä määritellyn HTTP API:n kutsuihin vastataan suoraan pilvifunktioilla. Funktiot yleensä operoivat jo valmiiksi pilvipalvelun tietokantoihin talletetun datan avulla.</p>\n<p>Serverlessissä ei siis ole kyse siitä että sovelluksissa ei olisi palvelinta, vaan tavasta määritellä palvelin. Sovelluskehittäjät voivat siirtyä ohjelmoinnissa korkeammalle abstraktiotasolle, ei ole enää tarvetta määritellä ohjelmallisesti HTTP-kutsujen reitityksiä, tietokantayhteyksiä ym., pilvi-infrastruktuuri tarjoaa kaiken tämän. Pilvifunktioilla on myös mahdollista saada helposti aikaan hyvin skaalautuvia järjestelmiä, esim. Amazon Lambda pystyy suorittamaan massiivisen määrän pilvifunktioita sekunnissa. Kaikki tämä tapahtuu infrastruktuurin toimesta automaattisesti, ei ole tarvetta käynnistellä uusia palvelimia ym.</p>\n<h3>Hyödyllisiä kirjastoja ja mielenkiintoisia linkkejä</h3>\n<p>JavaScriptin kehittäjäyhteisö on tuottanut valtavan määrän erilaisia hyödyllisiä kirjastoja ja jos olet koodaamassa\njotain vähänkin isompaa, kannattaa etsiä mitä valmista kalustoa on jo tarjolla. Seuraavassa listataan muutamia luotettavien tahojen hyväksi havaitsemia kirjastoja.</p>\n<p>Jos sovelluksessa on tarve operoida hieman monimutkaisemman datan kanssa, on jo <a href=\"/osa4/sovelluksen_rakenne_ja_testauksen_alkeet#tehtavat-4-3-4-7\">osassa 4</a> suositeltu kirjasto <a href=\"https://www.npmjs.com/package/lodash\">lodash</a> hyvä lisä. Jos olet mieltynyt funktionaaliseen ohjelmointityyliin, kannattaa harkita <a href=\"https://ramdajs.com/\">ramda</a>:n käyttöä.</p>\n<p>Jos sovelluksessa käsitellään aikaa, esimerkiksi <a href=\"https://github.com/date-fns/date-fns\">date-fns</a>-kirjasto tarjoaa siihen hyvän välineistön.  Jos sovellus sisältää monimutkaisia lomakkeita, voi <a href=\"https://react-hook-form.com/\">React Hook Form</a> olla hyvä valinta. Jos sovelluksessa tulee piirtää graafeja, on vaihtoehtoja lukuisia, sekä <a href=\"https://recharts.org/en-US/\">recharts</a> että <a href=\"https://github.com/highcharts/highcharts-react\">highcharts</a> ovat hyviksi havaittuja.</p>\n<p><a href=\"https://github.com/mweststrate/immer\">Immer</a> tarjoaa muutamista tietorakenteista <i>muuttumattomia</i> toteutuksia. Kirjastosta voi olla hyötyä Reduxia käytettäessä, sillä kuten osasta 6 <a href=\"/osa6/flux_arkkitehtuuri_ja_redux#puhtaat-funktiot-immutable\">muistamme</a> reducerien on oltava puhtaita funktioita eli ne eivät saa muuttaa storen tilaa vaan niiden on korvattava se muutostilanteissa uudella. </p>\n<p><a href=\"https://redux-saga.js.org/\">Redux-saga</a> tarjoaa osassa 6 käsitellylle <a href=\"/osa6/redux_sovelluksen_kommunikointi_palvelimen_kanssa#asynkroniset-actionit-ja-redux-thunk\">redux thunkille</a> vaihtoehtoisen tavan tehdä asynkronisia actioneja. Jotkut hypettää ja tykkää, itse en.</p>\n<p>Single page ‑sovelluksissa analytiikkatietojen kerääminen käyttäjien sivuston kanssa käymästä vuorovaikutuksesta on <a href=\"https://developers.google.com/analytics/devguides/collection/analyticsjs/single-page-applications\">haastavampaa</a> kuin perinteisissä, kokonaiseen sivun lataamiseen perustuvissa web-sovelluksissa. <a href=\"https://github.com/codler/react-ga4\">React Google Analytics 4</a> ‑kirjasto tuo tähän avun.</p>\n<p>Voit hyödyntää React-osaamistasi myös mobiilisovellusten toteuttamiseen Facebookin erittäin suositun <a href=\"https://facebook.github.io/react-native/\">React Native</a> ‑kirjaston avulla. Kurssin <a href=\"/osa10\">osa 10</a> käsittelee React Nativea.</p>\n<p>JavaScript-projektien projektinhallintaan ja bundlaamiseen käytettyjen työkalujen rintamalla on ollut tuulista, best practicet ovat vaihdelleet nopeasti (vuosiluvut ovat suuntaa-antavia, kukaan ei enää muista noin kauas menneisyyteen):</p>\n<ul>\n<li>2011 <a href=\"https://www.npmjs.com/package/bower\">Bower</a></li>\n<li>2012 <a href=\"https://www.npmjs.com/package/grunt\">Grunt</a></li>\n<li>2013-14 <a href=\"https://www.npmjs.com/package/gulp\">Gulp</a></li>\n<li>2012-14 <a href=\"https://www.npmjs.com/package/browserify\">Browserify</a></li>\n<li>2015-2021 <a href=\"https://www.npmjs.com/package/webpack\">Webpack</a></li>\n<li>2022- ?</li>\n</ul>\n<p>Hipsterien suurin into työkalukehitykseen näytti pysähtyneen Webpackin vallattua markkinat. Muutama vuosi sitten markkinoille ilmestyi uusi tulokas <a href=\"https://parceljs.org\">Parcel</a>, joka markkinoi olevansa yksinkertainen, sitähän Webpack ei missään nimessä ole, ja paljon nopeampi kuin Webpack. Lupaavan alun jälkeen Parcel ei kuitenkaan ole jatkanut nostettaan, ja siitä ei ollut Webpackin tappajaksi. Viime aikoina <a href=\"https://esbuild.github.io/\">esbuild</a> on ollut suhteellisen kovassa nosteessa ja haastaa jo tosissaan Webpackia.</p>\n<p>Sivu <a href=\"https://reactpatterns.com/\">https://reactpatterns.com/</a> tarjoaa tiiviissä muodossa listan parhaita react-käytänteitä, joista osa on jo tältäkin kurssilta tuttuja. Toinen samankaltainen lista on <a href=\"https://vasanthk.gitbooks.io/react-bits/\">react bits</a>.</p>\n<p><a href=\"https://www.reactiflux.com/\">Reactiflux</a> taas on suuri englanninkielinen React-kehittäjien keskusteluyhteisö Discordissa. Se voi olla yksi mahdollinen paikka saada tukea kurssin päättymisen jälkeen. Esimerkiksi useille kirjastoille löytyy kokonaan omat keskustelukanavat.</p>\n<p>Jos tiedät jotain suositeltavia linkkejä tai kirjastoja, tee pull request!</p>\n</div>","frontmatter":{"mainImage":{"publicURL":"/static/2184b1c35920cfc7a09e10660dea04eb/part-7.svg"},"part":7,"letter":"e","lang":"fi"}}},"pageContext":{"part":7,"letter":"e","lang":"fi"}},"staticQueryHashes":["3128451518"]}