{"componentChunkName":"component---src-templates-content-template-js","path":"/zh/part2/获取服务端的数据","result":{"data":{"markdownRemark":{"html":"<div class=\"content\">\n<!-- For a while now we have only been working on \"frontend\", i.e. client-side (browser) functionality. We will begin working on \"backend\", i.e. server-side functionality in the [third part](/en/part3) of this course. Nonetheless, we will now take a step in that direction by familiarizing ourselves with how code executing in the browser communicates with the backend.-->\n<p>这段时间，我们只致力于“前端”，即客户端（浏览器）的功能。我们将在本课程的<a href=\"/zh/part3\">第三章节</a>中开始研究“后端”，即服务端的功能。尽管如此，我们现在将朝着这个方向迈出一步，熟悉浏览器中执行的代码是如何与后端通信的。</p>\n<!-- Let's use a tool meant to be used during software development called [JSON Server](https://github.com/typicode/json-server) to act as our server.-->\n<p>让我们使用一个用于软件开发过程中的工具<a href=\"https://github.com/typicode/json-server\">JSON Server</a>来作为我们的服务端。</p>\n<!-- Create a file named <i>db.json</i> in the root directory of the previous <i>notes</i> project with the following content: -->\n<p>在之前的<i>notes</i>项目的根目录下创建一个名为<i>db.json</i>的文件，内容如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"notes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HTML is easy\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"important\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Browser can execute only JavaScript\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"important\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"GET and POST are the most important methods of HTTP protocol\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"important\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<!-- You can start the JSON Server without a separate installation by running the following _npx_ command in the root directory of the application: -->\n<p>你可以在应用的根目录下运行以下<em>npx</em>命令来启动JSON Server（<em>npx</em>无需额外安装）：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">npx json<span class=\"token operator\">-</span>server <span class=\"token operator\">--</span>port <span class=\"token number\">3001</span> db<span class=\"token punctuation\">.</span>json</code></pre></div>\n<!-- The JSON Server starts running on port 3000 by default, but we will now define an alternate port 3001. Let's navigate to the address <http://localhost:3001/notes> in the browser. We can see that JSON Server serves the notes we previously wrote to the file in JSON format: -->\n<p>JSON Server默认在端口3000上开始运行，但我们现在使用另一个端口3001。让我们在浏览器中导航到<a href=\"http://localhost:3001/notes\">http://localhost:3001/notes</a>这个地址。我们可以看到JSON Server以JSON格式提供我们之前写到文件中的各笔记：</p>\n<picture><img src=\"/static/dc892ed79d9b69f0d72dbd5302cc38fc/5a190/14new.png\" srcset=\"/static/dc892ed79d9b69f0d72dbd5302cc38fc/772e8/14new.png 200w,\n/static/dc892ed79d9b69f0d72dbd5302cc38fc/e17e5/14new.png 400w,\n/static/dc892ed79d9b69f0d72dbd5302cc38fc/5a190/14new.png 800w,\n/static/dc892ed79d9b69f0d72dbd5302cc38fc/c1b63/14new.png 1200w,\n/static/dc892ed79d9b69f0d72dbd5302cc38fc/29007/14new.png 1600w,\n/static/dc892ed79d9b69f0d72dbd5302cc38fc/49ee2/14new.png 1618w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<!-- If your browser doesn't have a way to format the display of JSON-data, then install an appropriate plugin, e.g. [JSONView](https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc) to make your life easier.-->\n<p>如果你的浏览器不能格式化显示JSON数据，那就安装一个合适的插件，例如<a href=\"https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc\">JSONView</a>，让你的生活更轻松。</p>\n<!-- Going forward, the idea will be to save the notes to the server, which in this case means saving them to the json-server. The React code fetches the notes from the server and renders them to the screen. Whenever a new note is added to the application, the React code also sends it to the server to make the new note persist in \"memory\".-->\n<p>接下来，我们的目标是将笔记保存到服务端，在这里指保存到json-server。React代码会从服务端获取笔记并渲染到屏幕上。每当应用中添加新笔记时，React代码也会将其发送到服务端，使新笔记能在“内存”中持久保存。</p>\n<!-- json-server stores all the data in the <i>db.json</i> file, which resides on the server. In the real world, data would be stored in some kind of database. However, json-server is a handy tool that enables the use of server-side functionality in the development phase without the need to program any of it.-->\n<p>json-server将所有数据存储在服务端的<i>db.json</i>文件中。在实际生产中，数据会存储在某种数据库中。然而，json-server是一个方便的工具，能让我们在开发阶段使用服务端的功能，而不需要进行任何编程。</p>\n<!-- We will get familiar with the principles of implementing server-side functionality in more detail in [part 3](/en/part3) of this course.-->\n<p>我们将在本课程的<a href=\"/zh/part3\">第3章节</a>中进一步熟悉实现服务端功能的原则。</p>\n<!-- ### The browser as a runtime environment -->\n<h3>浏览器作为运行环境</h3>\n<!-- Our first task is fetching the already existing notes to our React application from the address <http://localhost:3001/notes>.-->\n<p>我们的第一个任务是从地址<a href=\"http://localhost:3001/notes\">http://localhost:3001/notes</a>获取已存在的笔记到我们的React应用中。</p>\n<!-- In the part0 [example project](/en/part0/fundamentals_of_web_apps#running-application-logic-on-the-browser) we already learned a way to fetch data from a server using JavaScript. The code in the example was fetching the data using [XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest), otherwise known as an HTTP request made using an XHR object. This is a technique introduced in 1999, which every browser has supported for a good while now.-->\n<p>在第0章节的<a href=\"/zh/part0/web_%E5%BA%94%E7%94%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD#running-application-logic-in-the-browser\">示例项目</a>中，我们已经学习了一种使用JavaScript从服务端获取数据的方法。示例中的代码是使用<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\">XMLHttpRequest</a>来获取数据的，也就是使用XHR对象来进行HTTP请求。这是一种1999年引入的技术，现在每种浏览器都已经支持了很长时间。</p>\n<!-- The use of XHR is no longer recommended, and browsers already widely support the [fetch](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch) method, which is based on so-called [promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise), instead of the event-driven model used by XHR.-->\n<p>但不再推荐使用XHR了，浏览器已经广泛支持<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch\">fetch</a>方法，该方法基于所谓的<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\">Promise</a>，而不是XHR使用的事件驱动模型。</p>\n<!-- As a reminder from part0 (which one should in fact <i>remember to not use</i> without a pressing reason), data was fetched using XHR in the following way:-->\n<p>作为第0章节的提醒（如果没有迫切的理由，应该<i>记住不要使用</i>），使用XHR获取数据的方式如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> xhttp <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nxhttp<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onreadystatechange</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>readyState <span class=\"token operator\">==</span> <span class=\"token number\">4</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">==</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>responseText<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// handle the response that is saved in variable data</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nxhttp<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/data.json'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\nxhttp<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- Right at the beginning, we register an <i>event handler</i> to the <em>xhttp</em> object representing the HTTP request, which will be called by the JavaScript runtime whenever the state of the <em>xhttp</em> object changes. If the change in state means that the response to the request has arrived, then the data is handled accordingly. -->\n<p>在最开始时，我们给代表HTTP请求的<em>xhttp</em>对象注册了一个<i>事件处理函数</i>，每当<em>xhttp</em>对象的状态发生变化时，JavaScript运行时就会调用事件处理函数。如果状态的变化意味着对请求的响应已经到来，那么数据就会得到相应的处理。</p>\n<!-- It is worth noting that the code in the event handler is defined before the request is sent to the server. Despite this, the code within the event handler will be executed at a later point in time. Therefore, the code does not execute synchronously \"from top to bottom\", but does so <i>asynchronously</i>. JavaScript calls the event handler that was registered for the request at some point.-->\n<p>值得注意的是，尽管事件处理函数的代码是在请求被发送到服务端之前定义的，事件处理函数中的代码将在以后的时间点执行。因此，代码不是“从上到下”同步执行的，而是<i>异步</i>执行的。JavaScript会在某个时间点调用注册用于请求的事件处理函数。</p>\n<!-- A synchronous way of making requests that's common in Java programming, for instance, would play out as follows (NB, this is not actually working Java code):-->\n<p>同步的请求方式常见于Java编程中，下面是一个同步请求的例子（注意，这些Java代码并不能实际运行，只是举个例子）：</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">HTTPRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HTTPRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://studies.cs.helsinki.fi/exampleapp/data.json\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Note</span><span class=\"token punctuation\">></span></span> notes <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nnotes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>m <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<!-- In Java the code executes line by line and stops to wait for the HTTP request, which means waiting for the command _request.get(...)_ to finish. The data returned by the command, in this case the notes, are then stored in a variable, and we begin manipulating the data in the desired manner.-->\n<p>在Java中，代码逐行执行，会停下来等待HTTP请求，也就是会等待命令<em>request.get(...)</em>完成。命令返回的数据，在这里是笔记，会随后被存储在一个变量中，然后我们开始以我们想要的方式操作数据。</p>\n<!-- In contrast, JavaScript engines, or runtime environments follow the [asynchronous model](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop). In principle, this requires all [IO operations](https://en.wikipedia.org/wiki/Input/output) (with some exceptions) to be executed as non-blocking. This means that code execution continues immediately after calling an IO function, without waiting for it to return. -->\n<p>相比之下，JavaScript引擎，或者叫运行环境，遵循<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop\">异步模型</a>。原则上，这要求所有的<a href=\"https://en.wikipedia.org/wiki/Input/output\">IO操作</a>（除了一些例外）都以非阻塞方式执行。也就是说，在调用一个IO函数后，代码会立即继续执行，而不等待IO操作返回。</p>\n<!-- When an asynchronous operation is completed, or, more specifically, at some point after its completion, the JavaScript engine calls the event handlers registered to the operation.-->\n<p>当一个异步操作完成后，或者更确切地说，在完成后的某个时间点，JavaScript引擎会调用注册用于该操作的事件处理函数。</p>\n<!-- Currently, JavaScript engines are <i>single-threaded</i>, which means that they cannot execute code in parallel. As a result, it is a requirement in practice to use a non-blocking model for executing IO operations. Otherwise, the browser would \"freeze\" during, for instance, the fetching of data from a server.-->\n<p>目前，JavaScript引擎是<i>单线程的</i>，这意味着它们不能并行地执行代码。因此，在实践中需要使用非阻塞模型来执行IO操作。否则，在从服务端获取数据等过程中，浏览器会“冻住”。</p>\n<!-- Another consequence of this single-threaded nature of JavaScript engines is that if some code execution takes up a lot of time, the browser will get stuck for the duration of the execution. If we added the following code at the top of our application:-->\n<p>JavaScript引擎的这种单线程特性的另一个结果是，如果某些代码的执行占用了大量的时间，浏览器就会在执行的过程中卡住。如果我们在我们应用的顶部添加以下代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'loop..'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">50000000000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    i<span class=\"token operator\">++</span>\n  <span class=\"token punctuation\">}</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- everything would work normally for 5 seconds. However, when the function defined as the parameter for <em>setTimeout</em> is run, the browser will be stuck for the duration of the execution of the long loop. Even the browser tab cannot be closed during the execution of the loop, at least not in Chrome.-->\n<p>5秒内一切都正常。然而，当定义为<em>setTimeout</em>参数的函数运行时，浏览器将在长循环的执行过程中被卡住。甚至在执行循环的过程中也不能关闭浏览器标签页，至少在Chrome中不能。</p>\n<!-- For the browser to remain <i>responsive</i>, i.e., to be able to continuously react to user operations with sufficient speed, the code logic needs to be such that no single computation can take too long.-->\n<p>为了使浏览器保持<i>响应性</i>，即能够以足够的速度对用户的操作作出连续的反应，代码逻辑需要做到没有任何计算会花费太长时间。</p>\n<!-- There is a host of additional material on the subject to be found on the internet. One particularly clear presentation of the topic is the keynote by Philip Roberts called [What the heck is the event loop anyway?](https://www.youtube.com/watch?v=8aGhZQkoFbQ)-->\n<p>互联网上可以找到大量关于这个主题的额外资料。对这一主题的一个特别清晰的演讲是Philip Roberts的演讲<a href=\"https://www.youtube.com/watch?v=8aGhZQkoFbQ\">What the heck is the event loop anyway?</a>。</p>\n<!-- In today's browsers, it is possible to run parallelized code with the help of so-called [web workers](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers). The event loop of an individual browser window is, however, still only handled by a [single thread](https://medium.com/techtrument/multithreading-javascript-46156179cf9a).-->\n<p>在今天的浏览器中，可以借助所谓的<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers\">Web Worker</a>来并行地运行代码。然而，单个浏览器窗口的事件循环仍然只由<a href=\"https://medium.com/techtrument/multithreading-javascript-46156179cf9a\">单线程</a>处理。</p>\n<h3>npm</h3>\n<!-- Let's get back to the topic of fetching data from the server.-->\n<p>让我们回到从服务端获取数据的话题上来。</p>\n<!-- We could use the previously mentioned promise-based function [fetch](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch) to pull the data from the server. Fetch is a great tool. It is standardized and supported by all modern browsers (excluding IE). -->\n<p>我们可以使用之前提到的基于Promise的函数<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch\">fetch</a>来从服务端获取数据。fetch是一个伟大的工具。它是标准化的，被所有现代浏览器支持（除了IE）。</p>\n<!-- That being said, we will be using the [axios](https://github.com/axios/axios) library instead for communication between the browser and server. It functions like fetch but is somewhat more pleasant to use. Another good reason to use Axios is that it helps us get familiar with adding external libraries, or <i>npm packages</i>, to React projects. -->\n<p>也就是说，我们将使用<a href=\"https://github.com/axios/axios\">axios</a>库来实现浏览器和服务端之间的通信。它的功能类似于fetch，但使用起来更顺手一些。使用axios的另一个很好的理由是这么做能让我们熟悉向React项目中添加外部库，即<i>npm包</i>。</p>\n<!-- Nowadays, practically all JavaScript projects are defined using the node package manager, aka [npm](https://docs.npmjs.com/about-npm). The projects created using Vite also follow the npm format. A clear indicator that a project uses npm is the <i>package.json</i> file located at the root of the project: -->\n<p>现在，几乎所有JavaScript项目都是用node包管理器，也就是<a href=\"https://docs.npmjs.com/getting-started/what-is-npm\">npm</a>（node package manager）来定义的。使用Vite创建的项目也遵循npm的格式。项目使用npm的一个明显标志是位于项目根目录的<i>package.json</i>文件：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"part2-notes-frontend\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"private\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"module\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vite\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vite build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint .\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"preview\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vite preview\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^18.3.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react-dom\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^18.3.1\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"@eslint/js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^9.17.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@types/react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^18.3.18\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@types/react-dom\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^18.3.5\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@vitejs/plugin-react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.3.4\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"eslint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^9.17.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"eslint-plugin-react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.37.2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"eslint-plugin-react-hooks\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"eslint-plugin-react-refresh\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^0.4.16\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"globals\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^15.14.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"vite\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.0.5\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<!-- At this point, the <i>dependencies</i> part is of most interest to us as it defines what <i>dependencies</i>, or external libraries, the project has. -->\n<p>现在，我们最感兴趣的是<i>dependencies</i>部分，因为它定义了项目有哪些<i>依赖项</i>，即外部库。</p>\n<!-- We now want to use axios. Theoretically, we could define the library directly in the <i>package.json</i> file, but it is better to install it from the command line.-->\n<p>我们现在想使用axios。理论上，我们可以直接在<i>package.json</i>文件中定义这个库，但最好从命令行中安装它。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">npm install axios</code></pre></div>\n<!-- **NB _npm_-commands should always be run in the project root directory**, which is where the <i>package.json</i> file can be found.-->\n<p><strong>NB <em>npm</em>命令应该总是在项目根目录下运行</strong>，也就是可以找到<i>package.json</i>文件的地方。</p>\n<!-- Axios is now included among the other dependencies:-->\n<p>axios现在被包含在其他依赖项中：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"part2-notes-frontend\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"private\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"module\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vite\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vite build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint .\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"preview\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vite preview\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token property\">\"axios\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.7.9\"</span><span class=\"token punctuation\">,</span></span>    <span class=\"token property\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^18.3.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react-dom\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^18.3.1\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<!-- In addition to adding axios to the dependencies, the <em>npm install</em> command also <i>downloaded</i> the library code. As with other dependencies, the code can be found in the <i>node\\_modules</i> directory located in the root. As one might have noticed, <i>node\\_modules</i> contains a fair amount of interesting stuff.-->\n<p>除了将axios添加到依赖项中，<em>npm install</em>命令还会<i>下载</i>库的代码。和其他依赖项一样，代码可以在根目录下的<i>node_modules</i>目录中找到。你可能已经注意到，<i>node_modules</i>包含了相当多有趣的东西。</p>\n<!-- Let's make another addition. Install <i>json-server</i> as a development dependency (only used during development) by executing the command:-->\n<p>让我们再添加一个包。执行以下命令，将<i>json-server</i>安装为开发依赖项（只在开发过程中使用）：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">npm install json<span class=\"token operator\">-</span>server <span class=\"token operator\">--</span>save<span class=\"token operator\">-</span>dev</code></pre></div>\n<!-- and making a small addition to the <i>scripts</i> part of the <i>package.json</i> file:-->\n<p>并在<i>package.json</i>文件的<i>scripts</i>部分做一个小小的补充：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vite\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vite build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint .\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"preview\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vite preview\"</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token property\">\"server\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"json-server -p 3001 db.json\"</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<!-- We can now conveniently, without parameter definitions, start the json-server from the project root directory with the command:-->\n<p>现在我们可以方便地，不用定义任何参数，在项目根目录下用命令启动json-server：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">npm run server</code></pre></div>\n<!-- We will get more familiar with the _npm_ tool in the [third part of the course](/en/part3).-->\n<p>我们将在<a href=\"/zh/part3\">课程的第三章节</a>中进一步熟悉<em>npm</em>工具。</p>\n<!-- **NB** The previously started json-server must be terminated before starting a new one; otherwise there will be trouble:-->\n<p><strong>注意</strong> 在启动新的json-server之前，必须先终止之前启动的json-server；否则就会报错：</p>\n<picture><img src=\"/static/7f3c94f76fa1a5a1e55bf4dcd691d3e8/5a190/15b.png\" srcset=\"/static/7f3c94f76fa1a5a1e55bf4dcd691d3e8/772e8/15b.png 200w,\n/static/7f3c94f76fa1a5a1e55bf4dcd691d3e8/e17e5/15b.png 400w,\n/static/7f3c94f76fa1a5a1e55bf4dcd691d3e8/5a190/15b.png 800w,\n/static/7f3c94f76fa1a5a1e55bf4dcd691d3e8/c1b63/15b.png 1200w,\n/static/7f3c94f76fa1a5a1e55bf4dcd691d3e8/5df5d/15b.png 1572w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<!-- The red print in the error message informs us about the issue:-->\n<p>错误信息中的红色字告诉我们了问题：</p>\n<p><i>Cannot bind to port 3001. Please specify another port number either through --port argument or through the json-server.json configuration file</i></p>\n<!-- As we can see, the application is not able to bind itself to the [port](https://en.wikipedia.org/wiki/Port_(computer_networking)). The reason being that port 3001 is already occupied by the previously started json-server.-->\n<p>我们可以看到，应用无法将自己绑定到<a href=\"https://en.wikipedia.org/wiki/Port_(computer_networking)\">端口</a>。原因是3001端口已经被先前启动的json-server占用。</p>\n<!-- We used the command _npm install_ twice, but with slight differences:-->\n<p>我们用了两次<em>npm install</em>的命令，但略有不同：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">npm install axios\nnpm install json<span class=\"token operator\">-</span>server <span class=\"token operator\">--</span>save<span class=\"token operator\">-</span>dev</code></pre></div>\n<!-- There is a fine difference in the parameters. <i>axios</i> is installed as a runtime dependency of the application, because the execution of the program requires the existence of the library. On the other hand, <i>json-server</i> was installed as a development dependency (_--save-dev_), since the program itself doesn't require it. It is used for assistance during software development. There will be more on different dependencies in the next part of the course.-->\n<p>在参数上有细微差别。<i>axios</i>被安装为应用的运行时依赖项，因为程序的执行需要该库的存在。另一方面，<i>json-server</i>被安装为开发依赖项（<em>--save-dev</em>），因为程序本身并不需要它。它是用来在软件开发期间提供帮助的。在课程的下一部分会有更多关于不同依赖项的内容。</p>\n<!-- ### Axios and promises -->\n<h3>axios和Promise</h3>\n<!-- Now we are ready to use Axios. Going forward, json-server is assumed to be running on port 3001. -->\n<p>现在我们已经准备好使用axios了。今后，都假定json-server在3001端口运行。</p>\n<!-- NB: To run json-server and your react app simultaneously, you may need to use two terminal windows. One to keep json-server running and the other to run our React application. -->\n<p>注意：为了能够同时运行json-server和你的React应用，你可能需要使用两个终端窗口。一个用于保持json-server运行，另一个用于运行我们的React应用。</p>\n<!-- The library can be brought into use the same way other libraries, i.e., by using an appropriate <em>import</em> statement. -->\n<p>这个库可以通过和其他库一样的方式使用，即使用恰当的<em>import</em>语句。</p>\n<!-- Add the following to the file <i>main.jsx</i>: -->\n<p>在文件<i>main.jsx</i>中添加以下内容：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n\n<span class=\"token keyword\">const</span> promise <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/notes'</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> promise2 <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/foobar'</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>promise2<span class=\"token punctuation\">)</span></code></pre></div>\n<!-- If you open <http://localhost:5173/> in the browser, this should be printed to the console -->\n<p>如果你在浏览器中打开<a href=\"http://localhost:5173\">http://localhost:5173</a>，控制台应该会打印出以下内容</p>\n<picture><img src=\"/static/4fc5b28367c364237b3f37017125e346/5a190/16new.png\" srcset=\"/static/4fc5b28367c364237b3f37017125e346/772e8/16new.png 200w,\n/static/4fc5b28367c364237b3f37017125e346/e17e5/16new.png 400w,\n/static/4fc5b28367c364237b3f37017125e346/5a190/16new.png 800w,\n/static/4fc5b28367c364237b3f37017125e346/c1b63/16new.png 1200w,\n/static/4fc5b28367c364237b3f37017125e346/5df5d/16new.png 1572w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<!-- Axios' method _get_ returns a [promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises).-->\n<p>axios的<em>get</em>方法返回一个<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises\">Promise</a>。</p>\n<!-- The documentation on Mozilla's site states the following about promises:-->\n<p>Mozilla网站上的文档对Promise有如下说明：</p>\n<!-- > <i>A Promise is an object representing the eventual completion or failure of an asynchronous operation.</i>-->\n<blockquote>\n<p><i>Promise 是一个对象，它代表了一个异步操作的最终完成或者失败。</i></p>\n</blockquote>\n<!-- In other words, a promise is an object that represents an asynchronous operation. A promise can have three distinct states:-->\n<p>换句话说，一个Promise是一个代表异步操作的对象。一个Promise可以有三种不同的状态：</p>\n<!-- - The promise is <i>pending</i>: It means that the asynchronous operation corresponding to the promise has not yet finished and the final value is not available yet. -->\n<ul>\n<li>\n<p>Promise在<i>队列中（pending）</i>：这意味着Promise对应的异步操作尚未完成，还没有最终值。</p>\n<!-- - The promise is <i>fulfilled</i>: It means that the operation has been completed and the final value is available, which generally is a successful operation. -->\n</li>\n<li>\n<p>Promise<i>已完成（fulfilled）</i>：它意味着操作已经完成，已得到最终值，一般代表操作成功。</p>\n<!-- - The promise is <i>rejected</i>: It means that an error prevented the final value from being determined, which generally represents a failed operation. -->\n</li>\n<li>Promise<i>被拒绝（rejected）</i>：这意味着一个错误阻止了最终值的确定，一般代表操作失败。</li>\n</ul>\n<!-- There are many details related to promises, but understanding these three states is sufficient for us for now. If you want, you can read more about promises in [Mozilla's documentation](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise). -->\n<p>关于Promise还有许多细节，但目前而言理解这三种状态对我们来说就足够了。如果你想，你也可以在<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\">Mozilla的文档</a>中了解更多。</p>\n<!-- The first promise in our example is <i>fulfilled</i>, representing a successful _axios.get('http://localhost:3001/notes')_ request. The second one, however, is <i>rejected</i>, and the console tells us the reason. It looks like we were trying to make an HTTP GET request to a non-existent address.-->\n<p>我们例子中第一个Promise<i>已完成</i>，代表<em>axios.get('<a href=\"http://localhost:3001/notes&#x27;\">http://localhost:3001/notes'</a>)</em>请求成功。然而，第二个Promise<i>被拒绝</i>，并且控制台告诉了我们原因。看起来我们试图向一个不存在的地址发送HTTP GET请求。</p>\n<!-- If, and when, we want to access the result of the operation represented by the promise, we must register an event handler to the promise. This is achieved using the method <em>then</em>:-->\n<p>每当我们想访问Promise所代表的操作的结果，我们必须为Promise注册一个事件处理函数。这可以通过方法<em>then</em>实现：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> promise <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/notes'</span><span class=\"token punctuation\">)</span>\n\npromise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- The following is printed to the console:-->\n<p>以下内容将被打印到控制台：</p>\n<picture><img src=\"/static/83c299b357ca5f9ebe7540ad572fd701/5a190/17new.png\" srcset=\"/static/83c299b357ca5f9ebe7540ad572fd701/772e8/17new.png 200w,\n/static/83c299b357ca5f9ebe7540ad572fd701/e17e5/17new.png 400w,\n/static/83c299b357ca5f9ebe7540ad572fd701/5a190/17new.png 800w,\n/static/83c299b357ca5f9ebe7540ad572fd701/c1b63/17new.png 1200w,\n/static/83c299b357ca5f9ebe7540ad572fd701/29007/17new.png 1600w,\n/static/83c299b357ca5f9ebe7540ad572fd701/bce1e/17new.png 1696w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<!-- The JavaScript runtime environment calls the callback function registered by the <em>then</em> method providing it with a <em>response</em> object as a parameter. The <em>response</em> object contains all the essential data related to the response of an HTTP GET request, which would include the returned <i>data</i>, <i>status code</i>, and <i>headers</i>.-->\n<p>JavaScript运行环境调用由<em>then</em>方法注册的回调函数，为其提供一个<em>response</em>对象作为参数。<em>response</em>对象包含与HTTP GET请求响应相关的所有必要数据，包括返回的<i>数据</i>、<i>状态代码</i>和<i>标头</i>。</p>\n<!-- Storing the promise object in a variable is generally unnecessary, and it's instead common to chain the <em>then</em> method call to the axios method call, so that it follows it directly:-->\n<p>通常没有必要将Promise对象存储在一个变量中，而通常是将<em>then</em>方法调用链接到axios方法调用后，这样<em>then</em>方法就直接跟在axios方法后面：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/notes'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> notes <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>data\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>notes<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- The callback function now takes the data contained within the response, stores it in a variable, and prints the notes to the console.-->\n<p>回调函数现在接收响应中包含的数据，将其存储在一个变量中，并将笔记打印到控制台。</p>\n<!-- A more readable way to format <i>chained</i> method calls is to place each call on its own line:-->\n<p>将<i>链式</i>方法调用格式化为更可读的一种方法是把每个调用放在单独的一行：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">axios\n  <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/notes'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> notes <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>data\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>notes<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- The data returned by the server is plain text, basically just one long string. The axios library is still able to parse the data into a JavaScript array, since the server has specified that the data format is <i>application/json; charset=utf-8</i> (see previous image) using the <i>content-type</i> header.-->\n<p>服务端返回的数据是纯文本，基本上就是一个长字符串。axios库仍然能够将数据解析成一个JavaScript数组，因为服务端已经用<i>content-type</i>标头指定数据格式为<i>application/json; charset=utf-8</i>（见前一张图片）。</p>\n<!-- We can finally begin using the data fetched from the server.-->\n<p>我们终于可以开始使用从服务端上获取的数据了。</p>\n<!-- Let's try and request the notes from our local server and render them, initially as the App component. Please note that this approach has many issues, as we're rendering the entire <i>App</i> component only when we successfully retrieve a response:-->\n<p>让我们尝试从本地服务端上请求笔记，并渲染它们，作为最初的App组件。请注意，这种方法有很多问题，因为我们只有在成功获得一个响应时才会渲染整个<i>App</i>组件。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> ReactDOM <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom/client'</span>\n<span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n<span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">'./App'</span>\n\naxios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/notes'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> notes <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>data\n  ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App notes<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>notes<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- This method could be acceptable in some circumstances, but it's somewhat problematic. Let's instead move the fetching of the data into the <i>App</i> component.-->\n<p>这种方法在某些情况下是可以的，但它有些问题。让我们把获取数据的代码移到<i>App</i>组件中。</p>\n<!-- What's not immediately obvious, however, is where the command <em>axios.get</em> should be placed within the component.-->\n<p>然而，不明显的是，<em>axios.get</em>命令应该放在组件中的什么地方。</p>\n<!-- ### Effect-hooks -->\n<h3>Effect Hook</h3>\n<!-- We have already used [state hooks](https://react.dev/learn/state-a-components-memory) that were introduced along with React version [16.8.0](https://www.npmjs.com/package/react/v/16.8.0), which provide state to React components defined as functions - the so-called <i>functional components</i>. Version 16.8.0 also introduces [effect hooks](https://react.dev/reference/react/hooks#effect-hooks) as a new feature. As per the official docs: -->\n<p>我们已经使用了React<a href=\"https://www.npmjs.com/package/react/v/16.8.0\">16.8.0</a>版本中引入的<a href=\"https://react.dev/learn/state-a-components-memory\">State Hook</a>，它为定义为函数的React组件——所谓的<i>函数式组件</i>提供状态。16.8.0版本还引入了<a href=\"https://zh-hans.react.dev/reference/react/hooks#effect-hooks\">Effect Hook</a>这个新功能。按照官方文档的说法：</p>\n<!-- > <i>Effects let a component connect to and synchronize with external systems.</i>-->\n<blockquote>\n<p><i>Effect允许组件连接到外部系统并与之同步。</i></p>\n</blockquote>\n<!-- > <i>This includes dealing with network, browser DOM, animations, widgets written using a different UI library, and other non-React code.</i>-->\n<blockquote>\n<p><i>这包括处理网络、浏览器、DOM、动画、使用不同UI库编写的小部件以及其他非React代码。</i></p>\n</blockquote>\n<!-- As such, effect hooks are precisely the right tool to use when fetching data from a server.-->\n<p>因此，当要从服务端获取数据时，Effect Hook恰好是正确的工具。</p>\n<!-- Let's remove the fetching of data from <i>main.jsx</i>. Since we're going to be retrieving the notes from the server, there is no longer a need to pass data as props to the <i>App</i> component. So <i>main.jsx</i> can be simplified to: -->\n<p>让我们从<i>main.jsx</i>中移除获取数据的代码。既然我们要从服务端获取笔记，就不再需要将数据作为props传递给<i>App</i>组件。所以<i>main.jsx</i>可以简化为：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> ReactDOM <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-dom/client\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">\"./App\"</span><span class=\"token punctuation\">;</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<!-- The <i>App</i> component changes as follows:-->\n<p><i>App</i>组件的变化如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span></span><span class=\"token keyword\">import</span> Note <span class=\"token keyword\">from</span> <span class=\"token string\">'./components/Note'</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>notes<span class=\"token punctuation\">,</span> setNotes<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></span>  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>newNote<span class=\"token punctuation\">,</span> setNewNote<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>showAll<span class=\"token punctuation\">,</span> setShowAll<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'effect'</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">    axios</span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/notes'</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise fulfilled'</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token function\">setNotes</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\"></span><span class=\"gatsby-highlight-code-line\">  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'render'</span><span class=\"token punctuation\">,</span> notes<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> <span class=\"token string\">'notes'</span><span class=\"token punctuation\">)</span></span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<!-- We have also added a few helpful prints, which clarify the progression of the execution.-->\n<p>我们还添加了一些有用的打印语句来阐明执行的进程。</p>\n<!-- This is printed to the console:-->\n<p>控制台将打印出这些：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">render 0 notes\neffect\npromise fulfilled\nrender 3 notes</code></pre></div>\n<!-- First, the body of the function defining the component is executed and the component is rendered for the first time. At this point <i>render 0 notes</i> is printed, meaning data hasn't been fetched from the server yet.-->\n<p>首先，定义组件的函数主体被执行，组件被首次渲染。这时候打印了<i>render 0 notes</i>，意味着还没有从服务端获取数据。</p>\n<!-- The following function, or effect in React parlance:-->\n<p>下面的函数，用React的说法就是Effect：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'effect'</span><span class=\"token punctuation\">)</span>\n  axios\n    <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/notes'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise fulfilled'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">setNotes</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<!-- is executed immediately after rendering. The execution of the function results in <i>effect</i> being printed to the console, and the command <em>axios.get</em> initiates the fetching of data from the server as well as registers the following function as an <i>event handler</i> for the operation:-->\n<p>在渲染后会立即执行。函数的执行结果是<i>effect</i>被打印到控制台，然后命令<em>axios.get</em>开始从服务端获取数据，并注册以下函数作为该操作的<i>事件处理函数</i>：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise fulfilled'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">setNotes</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- When data arrives from the server, the JavaScript runtime calls the function registered as the event handler, which prints <i>promise fulfilled</i> to the console and stores the notes received from the server into the state using the function <em>setNotes(response.data)</em>.-->\n<p>当数据从服务端到达时，JavaScript运行时调用注册的事件处理函数，该函数将<i>promise fulfilled</i>打印到控制台，并用函数<em>setNotes(response.data)</em>将从服务端收到的笔记存储到状态中。</p>\n<!-- As always, a call to a state-updating function triggers the re-rendering of the component. As a result, <i>render 3 notes</i> is printed to the console, and the notes fetched from the server are rendered to the screen.-->\n<p>一如既往，调用会更新状态的函数会触发组件的重新渲染。结果，<i>render 3 notes</i>被打印到控制台，而从服务端获取的笔记被渲染到屏幕上。</p>\n<!-- Finally, let's take a look at the definition of the effect hook as a whole:-->\n<p>最后，让我们来看看整个Effect Hook的定义：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'effect'</span><span class=\"token punctuation\">)</span>\n  axios\n    <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/notes'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise fulfilled'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">setNotes</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- Let's rewrite the code a bit differently.-->\n<p>让我们以稍微不同的方式重写代码。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">hook</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'effect'</span><span class=\"token punctuation\">)</span>\n  axios\n    <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/notes'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise fulfilled'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">setNotes</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>hook<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- Now we can see more clearly that the function [useEffect](https://react.dev/reference/react/useEffect) takes <i>two parameters</i>. The first is a function, the <i>effect</i> itself. According to the documentation: -->\n<p>现在我们可以更清楚地看到，函数<a href=\"https://zh-hans.react.dev/reference/react/useEffect\">useEffect</a>需要<i>两个参数</i>。第一个参数是一个函数，即<i>Effect</i>本身。根据文档：</p>\n<!-- > <i>By default, effects run after every completed render, but you can choose to fire it only when certain values have changed.</i>-->\n<blockquote>\n<p><i>默认情况下，Effect会在每次完成渲染后运行，但你可以选择只在某些值发生变化时启动它。</i></p>\n</blockquote>\n<!-- So by default the effect is <i>always</i> run after the component has been rendered. In our case, however, we only want to execute the effect along with the first render.-->\n<p>所以在默认情况下，<i>每当</i>渲染完组件后，就会运行Effect。然而，在我们的例子中，我们只想在第一次渲染时执行Effect。</p>\n<!-- The second parameter of <em>useEffect</em> is used to [specify how often the effect is run](https://reactjs.org/docs/hooks-reference.html#conditionally-firing-an-effect). If the second parameter is an empty array <em>[]</em>, then the effect is only run along with the first render of the component.-->\n<p><em>useEffect</em>的第二个参数用于<a href=\"https://zh-hans.react.dev/reference/react/useEffect#parameters\">指定Effect的运行频率</a>。如果第二个参数是一个空的数组<em>[]</em>，那么Effect就只在组件的第一次渲染时运行。</p>\n<!-- There are many possible use cases for an effect hook other than fetching data from the server. However, this use is sufficient for us, for now.-->\n<p>除了从服务端获取数据之外，Effect Hook还有许多可能的使用场景。然而对我们来说，目前而言，这一用途已经足够了。</p>\n<!-- Think back to the sequence of events we just discussed. Which parts of the code are run? In what order? How often? Understanding the order of events is critical!-->\n<p>回想一下我们刚才讨论的事件的顺序。代码的哪些部分被运行？以什么顺序？什么时候会运行？理解事件的顺序是至关重要的！</p>\n<!-- Note that we could have also written the code for the effect function this way:-->\n<p>注意我们也可以这样写Effect函数的代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'effect'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">eventHandler</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise fulfilled'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">setNotes</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> promise <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/notes'</span><span class=\"token punctuation\">)</span>\n  promise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>eventHandler<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- A reference to an event handler function is assigned to the variable <em>eventHandler</em>. The promise returned by the <em>get</em> method of Axios is stored in the variable <em>promise</em>. The registration of the callback happens by giving the <em>eventHandler</em> variable, referring to the event-handler function, as an argument to the <em>then</em> method of the promise. It isn't usually necessary to assign functions and promises to variables, and a more compact way of representing things, as seen below, is sufficient. -->\n<p>一个事件处理函数的引用被赋值给变量<em>eventHandler</em>。axios的<em>get</em>方法返回的Promise被存储在变量<em>promise</em>中。回调函数的注册是通过把<em>eventHandler</em>变量，即事件处理函数的引用，作为Promise的<em>then</em>方法的参数来完成的。通常没有必要把函数和Promise赋值给变量，用更紧凑的方式来表示，如下所示，就足够了。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'effect'</span><span class=\"token punctuation\">)</span>\n  axios\n    <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3001/notes'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise fulfilled'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">setNotes</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- We still have a problem in our application. When adding new notes, they are not stored on the server.-->\n<p>我们的应用中仍然有一个问题。当添加新的笔记时，新笔记没有存储到服务端。</p>\n<!-- The code for the application, as described so far, can be found in full on [github](https://github.com/fullstack-hy2020/part2-notes-frontend/tree/part2-4), on branch <i>part2-4</i>. -->\n<p>到目前为止，应用的代码全部可以在<a href=\"https://github.com/fullstack-hy2020/part2-notes-frontend/tree/part2-4\">github</a>的<i>part2-4</i>分支找到。</p>\n<!-- ### The development runtime environment -->\n<h3>开发的运行环境</h3>\n<!-- The configuration for the whole application has steadily grown more complex. Let's review what happens and where. The following image describes the makeup of the application-->\n<p>整个应用的配置已经逐渐变得复杂。让我们回顾一下发生了什么，以及在哪里发生。下面的图片描述了应用的构成</p>\n<picture><img src=\"/static/0e3766361ce9d08f0c4fdd39152cf493/5a190/18e.png\" srcset=\"/static/0e3766361ce9d08f0c4fdd39152cf493/772e8/18e.png 200w,\n/static/0e3766361ce9d08f0c4fdd39152cf493/e17e5/18e.png 400w,\n/static/0e3766361ce9d08f0c4fdd39152cf493/5a190/18e.png 800w,\n/static/0e3766361ce9d08f0c4fdd39152cf493/77672/18e.png 1060w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<!-- The JavaScript code making up our React application is run in the browser. The browser gets the JavaScript from the <i>React dev server</i>, which is the application that runs after running the command <em>npm run dev</em>. The dev-server transforms the JavaScript into a format understood by the browser. Among other things, it stitches together JavaScript from different files into one file. We'll discuss the dev-server in more detail in part 7 of the course. -->\n<p>构成我们React应用的JavaScript代码在浏览器中运行。浏览器从<i>React dev server</i>，即运行命令<em>npm run dev</em>后启动的应用中获取JavaScript。dev-server将JavaScript转换为浏览器可以理解的格式。这个过程中会将不同文件的JavaScript拼接成一个文件。我们将在课程的第7章节更详细地讨论dev-server。</p>\n<!-- The React application running in the browser fetches the JSON formatted data from <i>json-server</i> running on port 3001 on the machine. The server we query the data from - <i>json-server</i> - gets its data from the file <i>db.json</i>.-->\n<p>浏览器中运行的React应用从运行在机器3001端口的<i>json-server</i>获取JSON格式的数据。我们查询数据的服务端——<i>json-server</i>——从文件<i>db.json</i>中获取数据。</p>\n<!-- At this point in development, all the parts of the application happen to reside on the software developer's machine, otherwise known as localhost. The situation changes when the application is deployed to the internet. We will do this in part 3.-->\n<p>开发到现在，应用的所有部分恰好都在软件开发者的机器，或者叫localhost上。当将应用部署到互联网上时，情况又会发生变化。我们将在第3章节做这件事。</p>\n</div>\n<div class=\"tasks\">\n<!-- <h3>Exercise 2.11.</h3> -->\n<h3>练习 2.11.</h3>\n<!-- <h4>2.11: The Phonebook Step 6</h4> -->\n<h4>2.11：电话簿 第6步</h4>\n<!-- We continue with developing the phonebook. Store the initial state of the application in the file <i>db.json</i>, which should be placed in the root of the project.-->\n<p>我们继续开发电话簿。将应用的初始状态存储在文件<i>db.json</i>中，该文件应放置在项目的根目录下。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"persons\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Arto Hellas\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"number\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"040-123456\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Ada Lovelace\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"number\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"39-44-5323523\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Dan Abramov\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"number\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"12-43-234345\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Mary Poppendieck\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"number\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"39-23-6423122\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"4\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<!-- Start json-server on port 3001 and make sure that the server returns the list of people by going to the address <http://localhost:3001/persons> in the browser.-->\n<p>在3001端口启动json-server，并通过在浏览器中访问地址<a href=\"http://localhost:3001/persons\">http://localhost:3001/persons</a>来确保服务端返回人员名单。</p>\n<!-- If you receive the following error message:-->\n<p>如果你收到以下错误信息：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">events<span class=\"token punctuation\">.</span>js<span class=\"token operator\">:</span><span class=\"token number\">182</span>\n      <span class=\"token keyword\">throw</span> er<span class=\"token punctuation\">;</span> <span class=\"token comment\">// Unhandled 'error' event</span>\n      <span class=\"token operator\">^</span>\n\n<span class=\"token literal-property property\">Error</span><span class=\"token operator\">:</span> listen <span class=\"token constant\">EADDRINUSE</span> <span class=\"token number\">0.0</span><span class=\"token number\">.0</span><span class=\"token number\">.0</span><span class=\"token operator\">:</span><span class=\"token number\">3001</span>\n    at Object<span class=\"token punctuation\">.</span><span class=\"token function\">_errnoException</span> <span class=\"token punctuation\">(</span>util<span class=\"token punctuation\">.</span>js<span class=\"token operator\">:</span><span class=\"token number\">1019</span><span class=\"token operator\">:</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span>\n    at <span class=\"token function\">_exceptionWithHostPort</span> <span class=\"token punctuation\">(</span>util<span class=\"token punctuation\">.</span>js<span class=\"token operator\">:</span><span class=\"token number\">1041</span><span class=\"token operator\">:</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span></code></pre></div>\n<!-- it means that port 3001 is already in use by another application, e.g. in use by an already running json-server. Close the other application, or change the port in case that doesn't work.-->\n<p>这意味着3001端口已经被另一个应用使用，比如被一个已经运行的json-server使用。关闭另一个应用，或者如果关闭另一个应用没用的话，那就换一个端口。</p>\n<!-- Modify the application such that the initial state of the data is fetched from the server using the <i>axios</i>-library. Complete the fetching with an [Effect hook](https://react.dev/reference/react/useEffect). -->\n<p>修改应用，使数据的初始状态是使用<i>axios</i>库从服务端获取的。用<a href=\"https://react.dev/reference/react/useEffect\">Effect Hook</a>来获取。</p>\n</div>","frontmatter":{"mainImage":{"publicURL":"/static/8869c2e065a6ae187c633a378e6fa6be/part-2.svg"},"part":2,"letter":"c","lang":"zh"}}},"pageContext":{"part":2,"letter":"c","lang":"zh"}},"staticQueryHashes":["3128451518"]}